{% extends "base.html" %}

{% block content %}

<!-- Page Title -->
<!--<div class="page-title" data-aos="fade">-->
<div class="page-title">
    <div class="heading container">
        <div class="container">
            <div class="row d-flex justify-content-center text-center">
                <div class="col-lg-12">
                    <h1>Welcome To Appointment Page 123</h1>                        
                    <!--<h2>Book Appointment with appointment {{ doctor.full_name }}</h2>-->
                </div>
            </div>
        </div>
    </div>      
</div>
<!-- End Page Title -->

<!--<form method="post" action="{{ url_for('book_appointment', doctor_id=doctor.doctor_id) }}">
    <div class="row gy-4">
        <div class="col-md-12">
            <label>Patient Name</label>
            <input name="patient_name" class="form-control col-md-12" required>
        </div>

        <div class="col-md-6">
            <label>Phone</label>
            <input name="patient_phone" class="form-control col-md-6" required>
        </div>

        <div class="col-md-6">
            <label>Email</label>
            <input name="patient_email" class="form-control col-md-6">
        </div>

        <div class="col-md-6">
            <label>Select Date</label>
            <input type="date" id="appointment_date" name="appointment_date" class="form-control" data-doctor-id="{{ doctor.doctor_id }}">
        </div>

        <div class="col-md-6">
            <label>Available Slots</label>
            <select name="slot" id="slots" class="form-control" required>
                <option value="">Select Slot</option>
            </select>
        </div>
        <button type="submit" class="btn btn-success mt-3 anchor">Confirm Appointment</button>-->
        <!--<a href="{{ url_for('book_appointment', doctor_id=doctor.doctor_id) }}" class="btn btn-success mt-3 anchor">Confirm Appointment</a>-->        
        <a href="{{ url_for('doctor') }}" class="btn btn-secondary mt-3 anchor">Cancel</a>
        <!--<div class="row justify-content-center">
            <div class="col-lg-6 text-center">
                <a href="appointment.html" class="btn-get-started">Book an appointment<br></a>            
            </div>
            <button type="submit">Book Appointment</button>
        </div>-->
        
    <!--</div>
  
</form>-->
<script>
document.addEventListener("DOMContentLoaded", function () {

    const dateInput = document.getElementById("appointment_date");
    const today = new Date();
    const yyyy = today.getFullYear();
    const mm = String(today.getMonth() + 1).padStart(2, '0');
    const dd = String(today.getDate()).padStart(2, '0');

    const mm2 = String(today.getMonth() + 1).padEnd(2, '0');
    const dd2 = String(today.getDate() + 7).padStart(2, '0');

    dateInput.min = `${yyyy}-${mm}-${dd}`;

    dateInput.max = `${yyyy}-${mm2}-${dd2}`;

    const slotSelect = document.getElementById("slots");

    if (!dateInput || !slotSelect) {
        console.error("Required elements not found");
        return;
    }

    dateInput.addEventListener("change", function () {
        const date = this.value;
        const doctorId = this.dataset.doctorId;
        
        if (!doctorId || !date) return;

        fetch(`/doctors/${doctorId}/available-slots?date=${date}`)
            .then(res => res.json())
            .then(slots => {            
                slotSelect.innerHTML = '<option value="">Select Slot</option>';

                if (slots.length === 0) {
                    const opt = document.createElement("option");
                    opt.textContent = "No slots available";
                    opt.disabled = true;
                    slotSelect.appendChild(opt);
                    return;
                }

                slots.forEach(s => {
                    const opt = document.createElement("option");
                    opt.value = s[0] + "|" + s[1];
                    opt.textContent = `${s[0]} - ${s[1]}`;
                    slotSelect.appendChild(opt);
                });
            })
            .catch(err => console.error("Fetch error:", err));
        });
    });
</script>
{% endblock %}
